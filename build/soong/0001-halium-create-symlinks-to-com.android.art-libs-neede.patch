From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: TheKit <nekit1000@gmail.com>
Date: Wed, 17 Nov 2021 00:19:13 +0200
Subject: [PATCH] (halium) create symlinks to com.android.art libs needed by
 libmedia

Change-Id: I476985a5370811d1d35eb8bc02943c87af7b69a8
---
 apex/vndk.go | 15 +++++++++++++++
 1 file changed, 15 insertions(+)

diff --git a/apex/vndk.go b/apex/vndk.go
index 75c0fb01b..90cdacf1a 100644
--- a/apex/vndk.go
+++ b/apex/vndk.go
@@ -145,6 +145,21 @@ func makeCompatSymlinks(name string, ctx android.ModuleContext) (symlinks []stri
 			dex2oat = "dex2oat64"
 		}
 		addSymlink("/apex/com.android.art/bin/"+dex2oat, "$(TARGET_OUT)/bin", "dex2oat")
+
+		// Halium: create symlinks to com.android.art libs needed by libmedia
+		if ctx.Config().Android64() {
+			addSymlink("/apex/com.android.art/lib64/libandroidicu.so", "$(TARGET_OUT)/lib64", "libandroidicu.so")
+			addSymlink("/apex/com.android.art/lib64/libicui18n.so", "$(TARGET_OUT)/lib64", "libicui18n.so")
+			addSymlink("/apex/com.android.art/lib64/libicuuc.so", "$(TARGET_OUT)/lib64", "libicuuc.so")
+			addSymlink("/apex/com.android.art/lib64/libnativehelper.so", "$(TARGET_OUT)/lib64", "libnativehelper.so")
+		}
+		if !ctx.Config().Android64() || ctx.DeviceConfig().DeviceSecondaryArch() != "" {
+			addSymlink("/apex/com.android.art/lib/libandroidicu.so", "$(TARGET_OUT)/lib", "libandroidicu.so")
+			addSymlink("/apex/com.android.art/lib/libicui18n.so", "$(TARGET_OUT)/lib", "libicui18n.so")
+			addSymlink("/apex/com.android.art/lib/libicuuc.so", "$(TARGET_OUT)/lib", "libicuuc.so")
+			addSymlink("/apex/com.android.art/lib/libnativehelper.so", "$(TARGET_OUT)/lib", "libnativehelper.so")
+		}
+
 		return
 	}
 	return
-- 
2.25.1

